# === 兼容版智能分流（机场订阅 + 自动规则）===
# 用途：拿机场节点→按规则自动分流→自动测速与故障切换
# 适用：Clash Meta / Clash Premium 新版

mixed-port: 7890
allow-lan: true
mode: rule
log-level: info
ipv6: true

# 1) 从机场订阅拉取节点（自动更新）
proxy-providers:
  youtu:                # 名称可自定义
    type: http
    url: "YOUR_SUBSCRIPTION_URL"   # ← 改成你的机场订阅链接
    interval: 86400                 # 每天更新
    path: ./providers/youtu.yaml
    health-check:
      enable: true
      # 用 204 测速探测
      url: http://www.gstatic.com/generate_204   # 与你的模板一致的探测地址
      interval: 600

# 2) 代理分组（自动选择 + 故障转移 + 手动选择）
proxy-groups:
  - name: 🌐 国外流量
    type: select
    proxies:
      - ♻️ 自动选择
      - 🔁 故障转移
      - 🧪 手动选择

  - name: ♻️ 自动选择
    type: url-test
    use:
      - youtu
    url: http://www.gstatic.com/generate_204
    interval: 600

  - name: 🔁 故障转移
    type: fallback
    use:
      - youtu
    url: http://www.gstatic.com/generate_204
    interval: 600

  - name: 🧪 手动选择
    type: select
    use:
      - youtu

  - name: 🎬 国际流媒体
    type: select
    proxies:
      - ♻️ 自动选择
      - 🔁 故障转移
      - 🧪 手动选择

  - name: 🎮 游戏平台
    type: select
    proxies:
      - ♻️ 自动选择
      - 🔁 故障转移
      - 🧪 手动选择

  - name: 🏠 大陆流量
    type: select
    proxies:
      - DIRECT
      - 🌐 国外流量  # 若部分国内站被劫持可切到代理

  - name: ➡️ 直接连接
    type: select
    proxies:
      - DIRECT

# 3) 规则（复用 Rg4* 模板的 rule-providers，自动更新）
rule-providers:
  Direct:
    type: http
    behavior: classical
    path: ./RuleSet/Direct.yaml
    url: https://resource.touhou.center/ios_rule_script/rule/Clash/Direct/Direct.yaml
    interval: 86400
  GlobalMedia:
    type: http
    behavior: classical
    path: ./RuleSet/GlobalMedia.yaml
    url: https://resource.touhou.center/ios_rule_script/rule/Clash/GlobalMedia/GlobalMedia_Classical.yaml
    interval: 86400
  AsianMedia:
    type: http
    behavior: classical
    path: ./RuleSet/AsianMedia.yaml
    url: https://resource.touhou.center/ios_rule_script/rule/Clash/AsianMedia/AsianMedia.yaml
    interval: 86400
  Game:
    type: http
    behavior: classical
    path: ./RuleSet/Game.yaml
    url: https://resource.touhou.center/ios_rule_script/rule/Clash/Game/Game.yaml
    interval: 86400
  Global:
    type: http
    behavior: classical
    path: ./RuleSet/Global.yaml
    url: https://resource.touhou.center/ios_rule_script/rule/Clash/Global/Global_Classical.yaml
    interval: 86400
  ChinaMedia:
    type: http
    behavior: classical
    path: ./RuleSet/ChinaMedia.yaml
    url: https://resource.touhou.center/ios_rule_script/rule/Clash/ChinaMedia/ChinaMedia.yaml
    interval: 86400
  China:
    type: http
    behavior: classical
    path: ./RuleSet/China.yaml
    url: https://resource.touhou.center/ios_rule_script/rule/Clash/China/China_Classical.yaml
    interval: 86400
  Lan:
    type: http
    behavior: classical
    path: ./RuleSet/Lan.yaml
    url: https://resource.touhou.center/ios_rule_script/rule/Clash/Lan/Lan.yaml
    interval: 86400
  ChinaIPs:
    type: http
    behavior: classical
    path: ./RuleSet/ChinaIPs.yaml
    url: https://resource.touhou.center/ios_rule_script/rule/Clash/ChinaIPs/ChinaIPs_Classical.yaml
    interval: 86400

# 4) 分流规则（从上到下匹配）
rules:
  - RULE-SET,Direct,DIRECT             # 直连名单优先
  - RULE-SET,GlobalMedia,🎬 国际流媒体  # 国际流媒体 → 专门分组
  - RULE-SET,AsianMedia,🎬 国际流媒体   # 亚洲流媒体国际版 → 分组
  - RULE-SET,Game,🎮 游戏平台          # 游戏平台 → 分组
  - RULE-SET,Global,🌐 国外流量         # 国际网站 → 走代理
  - RULE-SET,ChinaMedia,🏠 大陆流量     # 大陆流媒体 → 直连优先
  - RULE-SET,China,🏠 大陆流量          # 大陆域名 → 直连
  - RULE-SET,Lan,➡️ 直接连接            # 局域网 → 直连
  - RULE-SET,ChinaIPs,🏠 大陆流量       # 大陆 IP 段 → 直连
  - MATCH,🌐 国外流量                   # 兜底：其余走代理
